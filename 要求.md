Sure! Here is the content of the file converted into Markdown format:

# 《人工智能编程基础》第十二周上机练习

## 零、实验背景
- 大语言模型本质上是通过根据输入预测下一个最可能的 token 序列来生成输出。由于它并不具备实时的环境感知能力，因此无法准确回答与当前环境状态相关的问题，例如【当前时间】或【某地天气】等。此外，由于训练语料的覆盖范围和时效性有限，对于某些专业领域的问题，模型的回答可能不够准确或存在偏差，例如【出行路线规划】等。
- 为了解决上述问题，目前提出了一种让大语言模型调用外部工具（比如 API）的方法，以增强其回答的准确性和实用性。

## 一、实验目标
- 本次实验将在第十周上机练习的基础上，进一步完善对话系统功能，使大语言模型能够调用外部工具，以准确回答以下类型的问题：
  - 询问当前时间
  - 询问某地天气
  - 询问从 A 地到 B 地的路线方案

## 二、实验步骤
### 1. 运行示例代码，理解大语言模型调用外部函数的机制
#### a. 示例代码说明：
- 功能：让大模型能够通过调用 `get_time` 函数，准确回答“现在几点了”这类问题。
- 执行步骤：
  1. 解压提供的 `functionCall.zip` 文件
  2. 进入 `functionCall` 目录
  3. 在 `run.py` 文件的第 7-8 行，填写你的大模型 API 的 `BASE_URL` 和 `API_KEY`
  4. 执行命令 `python run.py`，观察其输出当前时间的结果

#### b. 代码结构说明：
- `functionCallList.py`：实现了具体的可调用函数，如 `get_time`（获取当前时间）、`get_weather`（通过第三方 API 查询天气）等。
- `functionCallRegistry.py`：定义了大模型可调用函数的注册列表，并以 JSON 格式描述了每个函数的名称、参数和功能（可参考 DeepSeek 等模型的 Function Call 实现方式）。
- `run.py`：
  - 将所有可调用函数的描述以及用户输入（如“现在几点了”）传递给大模型（第 18-21 行）
  - 解析大模型返回的函数名与参数，调用相应函数并获取执行结果（第 26-30 行）
  - 将函数结果再次发送给大模型，生成最终回答（第 32-35 行）

### 2. 在第十周的连续对话代码基础上，加入上述代码，使得该系统可以正确回答用户询问时间相关的问题。仍然要求：
- 能感知并利用上下文进行多轮对话
- 回答以流式方式输出
- 输出示例如下：
  ```
  ~ python run.py
  Q: 用户输入问题1
  A: 大模型回答问题1
  Q: 用户输入问题2
  A: 大模型回答问题2
  ...
  ```

### 3. 扩展系统功能使其能够支持天气查询（如“杭州今天天气如何”）与路径规划（如“从复旦大学江湾校区到五角场要怎么走”）这两类问题
#### a. 天气查询功能：
- `weatherapi` 提供天气查询服务
- 在 `functionCallList.py` 中，`get_weather` 函数实现了调用 weatherapi 提供的 Web API 来获得某地天气的功能
- 你需要在官网注册账户，获取 `API_KEY`，并填入 `WEATHER_API_KEY`

#### b. 路径规划功能：
- 高德地图开放平台提供路径规划服务
- 在 `functionCallList.py` 中，实现了调用高德提供的 Web API 服务的代码，包括：
  - `get_coordinates_from_address` 函数：将详细的地址转换为对应的经纬度坐标
  - `get_walking_route_planning` 函数：给出从起点到终点的步行通勤方案，起点终点为某地的经纬度坐标
  - `get_public_transportation_route_planning` 函数：给出从起点到终点的综合各类公共交通（火车、公交、地铁）的通勤方案，起点终点为某地的经纬度坐标
  - `get_drive_route_planning` 函数：给出从起点到终点的驾车通勤出行方案，起点终点为某地的经纬度坐标
  - `get_bicycling_route_planning` 函数：给出从起点到终点的骑行通勤出行方案，起点终点为某地的经纬度坐标
- 注册高德开发者账户，创建应用以获取 `AMAP_API_KEY`，并填入相应位置
- 修改 `functionCallRegistry.py` 和 `run.py` 文件完成上述功能

### 4. （选做，实现可少量加分，不实现不扣分）使用大模型编程框架来实现支持工具调用的对话系统
- 由于让大语言模型具备调用外部工具的能力是当前非常常见的需求，许多 LLM 编程框架（如 LangChain）已对该功能进行了封装与抽象，极大地简化了开发流程。
- 本题要求你基于一种现有的大语言模型编程框架来实现上述功能，即支持询问当前时间、天气、两地出行路线的对话系统，仍然要求能感知上下文并且对结果流式输出，输出示同步骤 2.c 描述。
- 代码实现在名为 `run.py` 的文件中（与步骤 1-3 实现的代码放在不同文件夹下），即执行 `python run.py` 能够与程序进行对话
- 参考文档：
  - LangChain Function Calling
  - LangChain DeepSeek

## 三、提交说明！！！
- 在 elearning 上提交一个 zip 文件，命名为【学号-姓名.zip】，其中包含的内容如下：
  ```
  functionCall
  ├── functionCallList.py
  ├── functionCallRegistry.py
  └── run.py
  functionCall-Framework (如果有)
  ├── run.py
  └── ...
  ```
- 请务必按照上述格式提交，否则予以扣分
- 要求使用的所有 API Key 有效期需要持续到本学期该课程结束
- 请在下课前提交一个版本；在 **2025年5月15日23:59** 前提交终版，在这期间可以多次提交
  - 如果没有提交最终版本，则按照上机课后提交的版本给分